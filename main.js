/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";function e(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&n(t)}}function t(e){e.target===e.currentTarget&&n(e.currentTarget)}function r(r){r.classList.add("popup_is-opened"),document.addEventListener("keydown",e),r.addEventListener("mousedown",t)}function n(r){r.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e),r.removeEventListener("mousedown",t)}function o(e,t,r,n,o){!function(e,t,r){u(e)?c(e,t,r):function(e,t,r){if(t){if(e.classList.add(r.inputErrorClass),e.validity.patternMismatch&&e.dataset.errorMessage)t.textContent=e.dataset.errorMessage;else if("url"!==e.type||i(e.value)){if(e.validity.valueMissing)t.textContent="Это поле обязательно для заполнения";else if(e.validity.tooShort||e.validity.tooLong){var n=e.minLength,o=e.maxLength;t.textContent="Должно быть от ".concat(n," до ").concat(o," символов")}}else t.textContent="Введите корректный URL";t.classList.add(r.errorClass)}}(e,t,r)}(t,e.querySelector(".popup__error_type_".concat(a(t))),o),l(r,n,o)}function a(e){return"place-name"===e.name?"card-name":"link"===e.name?"url":"avatar"===e.name?"avatar":e.name}function u(e){return"name"===e.name||"place-name"===e.name?new RegExp(e.pattern).test(e.value):"url"===e.type?i(e.value):e.validity.valid}function i(e){if(!e)return!1;try{return new URL(e),!0}catch(e){return!1}}function c(e,t,r){t&&(e.classList.remove(r.inputErrorClass),t.classList.remove(r.errorClass),t.textContent="")}function l(e,t,r){if(t){var n=e.every((function(e){return u(e)}));t.disabled=!n,t.classList.toggle(r.inactiveButtonClass,!n)}}function s(e,t){var r=e.querySelectorAll(t.inputSelector),n=e.querySelector(t.submitButtonSelector);r.forEach((function(r){c(r,e.querySelector(".popup__error_type_".concat(a(r))),t)})),n&&(n.disabled=!0,n.classList.add(t.inactiveButtonClass))}function p(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var c=n&&n.prototype instanceof i?n:i,l=Object.create(c.prototype);return f(l,"_invoke",function(r,n,o){var a,i,c,l=0,s=o||[],p=!1,f={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return a=t,i=0,c=e,f.n=r,u}};function d(r,n){for(i=r,c=n,t=0;!p&&l&&!o&&t<s.length;t++){var o,a=s[t],d=f.p,v=a[2];r>3?(o=v===n)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=r<2&&d<a[1])?(i=0,f.v=n,f.n=a[1]):d<v&&(o=r<3||a[0]>n||n>v)&&(a[4]=r,a[5]=n,f.n=v,i=0))}if(o||r>1)return u;throw p=!0,n}return function(o,s,v){if(l>1)throw TypeError("Generator is already running");for(p&&1===s&&d(s,v),i=s,c=v;(t=i<2?e:c)||!p;){a||(i?i<3?(i>1&&(f.n=-1),d(i,c)):f.n=c:f.v=c);try{if(l=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(p=f.n<0)?c:r.call(n,f))!==u)break}catch(t){a=e,i=1,c=t}finally{l=1}}return{value:t,done:p}}}(r,o,a),!0),l}var u={};function i(){}function c(){}function l(){}t=Object.getPrototypeOf;var s=[][n]?t(t([][n]())):(f(t={},n,(function(){return this})),t),d=l.prototype=i.prototype=Object.create(s);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,f(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=l,f(d,"constructor",l),f(l,"constructor",c),c.displayName="GeneratorFunction",f(l,o,"GeneratorFunction"),f(d),f(d,o,"Generator"),f(d,n,(function(){return this})),f(d,"toString",(function(){return"[object Generator]"})),(p=function(){return{w:a,m:v}})()}function f(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}f=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function a(t,r){f(e,t,(function(e){return this._invoke(t,r,e)}))}a("next",0),a("throw",1),a("return",2)}},f(e,t,r,n)}function d(e,t,r,n,o,a,u){try{var i=e[a](u),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}var v={baseUrl:"https://nomoreparties.co/v1/wff-cohort-42",headers:{authorization:"7696ee24-0ffa-43ba-9ef5-e8fa7c29fb61","Content-Type":"application/json"}},m=function(){var e,t=(e=p().m((function e(t){var r,n,o,a,u,i,c=arguments;return p().w((function(e){for(;;)switch(e.n){case 0:return o={method:r=c.length>1&&void 0!==c[1]?c[1]:"GET",headers:v.headers},(n=c.length>2&&void 0!==c[2]?c[2]:null)&&(o.body=JSON.stringify(n)),e.p=1,e.n=2,fetch("".concat(v.baseUrl).concat(t),o);case 2:if((a=e.v).ok){e.n=4;break}return e.n=3,a.json().catch((function(){return{}}));case 3:throw u=e.v,new Error(u.message||"Ошибка ".concat(a.status));case 4:return e.n=5,a.json();case 5:return e.a(2,e.v);case 6:throw e.p=6,i=e.v,console.error("Ошибка запроса ".concat(r," ").concat(t,":"),i),i;case 7:return e.a(2)}}),e,null,[[1,6]])})),function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function u(e){d(a,n,o,u,i,"next",e)}function i(e){d(a,n,o,u,i,"throw",e)}u(void 0)}))});return function(e){return t.apply(this,arguments)}}(),y=function(e){return m("/users/me/avatar","PATCH",{avatar:e})},_=function(e){return m("/cards/".concat(e),"DELETE")},b=function(e){return m("/cards/likes/".concat(e),"PUT")},h=function(e){return m("/cards/likes/".concat(e),"DELETE")};function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function w(){var e,t,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function a(r,n,o,a){var c=n&&n.prototype instanceof i?n:i,l=Object.create(c.prototype);return S(l,"_invoke",function(r,n,o){var a,i,c,l=0,s=o||[],p=!1,f={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,r){return a=t,i=0,c=e,f.n=r,u}};function d(r,n){for(i=r,c=n,t=0;!p&&l&&!o&&t<s.length;t++){var o,a=s[t],d=f.p,v=a[2];r>3?(o=v===n)&&(c=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=d&&((o=r<2&&d<a[1])?(i=0,f.v=n,f.n=a[1]):d<v&&(o=r<3||a[0]>n||n>v)&&(a[4]=r,a[5]=n,f.n=v,i=0))}if(o||r>1)return u;throw p=!0,n}return function(o,s,v){if(l>1)throw TypeError("Generator is already running");for(p&&1===s&&d(s,v),i=s,c=v;(t=i<2?e:c)||!p;){a||(i?i<3?(i>1&&(f.n=-1),d(i,c)):f.n=c:f.v=c);try{if(l=2,a){if(i||(o="next"),t=a[o]){if(!(t=t.call(a,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,i<2&&(i=0)}else 1===i&&(t=a.return)&&t.call(a),i<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((t=(p=f.n<0)?c:r.call(n,f))!==u)break}catch(t){a=e,i=1,c=t}finally{l=1}}return{value:t,done:p}}}(r,o,a),!0),l}var u={};function i(){}function c(){}function l(){}t=Object.getPrototypeOf;var s=[][n]?t(t([][n]())):(S(t={},n,(function(){return this})),t),p=l.prototype=i.prototype=Object.create(s);function f(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,l):(e.__proto__=l,S(e,o,"GeneratorFunction")),e.prototype=Object.create(p),e}return c.prototype=l,S(p,"constructor",l),S(l,"constructor",c),c.displayName="GeneratorFunction",S(l,o,"GeneratorFunction"),S(p),S(p,o,"Generator"),S(p,n,(function(){return this})),S(p,"toString",(function(){return"[object Generator]"})),(w=function(){return{w:a,m:f}})()}function S(e,t,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}S=function(e,t,r,n){if(t)o?o(e,t,{value:r,enumerable:!n,configurable:!n,writable:!n}):e[t]=r;else{function a(t,r){S(e,t,(function(e){return this._invoke(t,r,e)}))}a("next",0),a("throw",1),a("return",2)}},S(e,t,r,n)}function k(e,t,r,n,o,a,u){try{var i=e[a](u),c=i.value}catch(e){return void r(e)}i.done?t(c):Promise.resolve(c).then(n,o)}function E(e){return function(){var t=this,r=arguments;return new Promise((function(n,o){var a=e.apply(t,r);function u(e){k(a,n,o,u,i,"next",e)}function i(e){k(a,n,o,u,i,"throw",e)}u(void 0)}))}}var L,C={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},P={cardTemplate:document.querySelector("#card-template").content,placesList:document.querySelector(".places__list"),editForm:document.forms["edit-profile"],newCardForm:document.forms["new-place"],editAvatarForm:document.forms["edit-avatar"],profileName:document.querySelector(".profile__title"),profileJob:document.querySelector(".profile__description"),profileImage:document.querySelector(".profile__image"),editProfileButton:document.querySelector(".profile__edit-button"),addCardButton:document.querySelector(".profile__add-button"),editAvatarButton:document.querySelector(".profile__image-edit-button"),editPopup:document.querySelector(".popup_type_edit"),newCardPopup:document.querySelector(".popup_type_new-card"),imagePopup:document.querySelector(".popup_type_image"),deletePopup:document.querySelector(".popup_type_delete-card"),editAvatarPopup:document.querySelector(".popup_type_edit-avatar")},q=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";e.textContent=t?"Сохранение...":r,e.disabled=t},F=function(){var e=E(w().m((function e(t){var r,n,o,a,u,i;return w().w((function(e){for(;;)switch(e.n){case 0:if(r=t.dataset.cardId,n=t.querySelector(".card__like-button"),o=t.querySelector(".card__like-count"),a=n.classList.contains("card__like-button_is-active"),e.p=1,n.disabled=!0,!a){e.n=3;break}return e.n=2,h(r);case 2:i=e.v,e.n=5;break;case 3:return e.n=4,b(r);case 4:i=e.v;case 5:u=i,o.textContent=u.likes.length,n.classList.toggle("card__like-button_is-active"),e.n=7;break;case 6:e.p=6,e.v,G("Ошибка при обновлении лайка");case 7:return e.p=7,n.disabled=!1,e.f(7);case 8:return e.a(2)}}),e,null,[[1,6,7,8]])})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=E(w().m((function e(t,o){var a,u;return w().w((function(e){for(;;)switch(e.n){case 0:r(P.deletePopup),a=P.deletePopup.querySelector(".popup__button"),u=function(){var e=E(w().m((function e(){return w().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,q(a,!0,"Удаление..."),e.n=1,_(t);case 1:o.remove(),n(P.deletePopup),e.n=3;break;case 2:e.p=2,e.v,G("Не удалось удалить карточку");case 3:return e.p=3,q(a,!1,"Да"),e.f(3);case 4:return e.a(2)}}),e,null,[[0,2,3,4]])})));return function(){return e.apply(this,arguments)}}(),a.addEventListener("click",u,{once:!0});case 1:return e.a(2)}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),A=function(e){return function(e,t,r,n,o,a){var u,i=a.querySelector(".card").cloneNode(!0),c=i.querySelector(".card__image"),l=i.querySelector(".card__title"),s=i.querySelector(".card__delete-button"),p=i.querySelector(".card__like-button"),f=i.querySelector(".card__like-count");return c.src=e.link,c.alt=e.name,l.textContent=e.name,f.textContent=e.likes?e.likes.length:0,i.dataset.cardId=e._id,e.owner._id!==t?s.remove():s.addEventListener("click",(function(t){t.stopPropagation(),r(e._id,i)})),!!(null===(u=e.likes)||void 0===u?void 0:u.some((function(e){return e._id===t})))&&p.classList.add("card__like-button_is-active"),p.addEventListener("click",(function(e){e.stopPropagation(),n(i)})),c.addEventListener("click",(function(){return o()})),i}(e,L,T,F,(function(){return I(e)}),P.cardTemplate)},O=function(){var e=E(w().m((function e(){var t,r,n,o;return w().w((function(e){for(;;)switch(e.n){case 0:return e.p=0,e.n=1,Promise.all([m("/users/me"),m("/cards")]);case 1:t=e.v,u=2,r=function(e){if(Array.isArray(e))return e}(a=t)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,a,u,i=[],c=!0,l=!1;try{if(a=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=a.call(r)).done)&&(i.push(n.value),i.length!==t);c=!0);}catch(e){l=!0,o=e}finally{try{if(!c&&null!=r.return&&(u=r.return(),Object(u)!==u))return}finally{if(l)throw o}}return i}}(a,u)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?g(e,t):void 0}}(a,u)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),n=r[0],o=r[1],L=n._id,j(n),x(o),e.n=3;break;case 2:e.p=2,e.v,G("Ошибка загрузки данных");case 3:return e.a(2)}var a,u}),e,null,[[0,2]])})));return function(){return e.apply(this,arguments)}}(),j=function(e){P.profileName.textContent=e.name,P.profileJob.textContent=e.about,e.avatar&&(P.profileImage.style.backgroundImage="url('".concat(e.avatar,"')"))},x=function(e){P.placesList.innerHTML="";var t=document.createDocumentFragment();e.forEach((function(e){return t.append(A(e))})),P.placesList.append(t)},G=function(e){var t=document.createElement("div");t.className="notification",t.textContent=e,document.body.append(t),setTimeout((function(){return t.remove()}),3e3)},B=function(e){try{return new URL(e),!0}catch(e){return!1}},I=function(e){var t=P.imagePopup.querySelector(".popup__image"),n=P.imagePopup.querySelector(".popup__caption");t.src=e.link,t.alt=e.name,n.textContent=e.name,r(P.imagePopup)},M=function(){P.editForm.elements.name.value=P.profileName.textContent,P.editForm.elements.description.value=P.profileJob.textContent,s(P.editForm,C),r(P.editPopup)},N=function(){P.newCardForm.reset(),s(P.newCardForm,C),r(P.newCardPopup)},U=function(){P.editAvatarForm.reset(),s(P.editAvatarForm,C),r(P.editAvatarPopup)},D=function(){var e=E(w().m((function e(t){var r,o;return w().w((function(e){for(;;)switch(e.n){case 0:return t.preventDefault(),r=t.submitter,e.p=1,q(r,!0),e.n=2,a=P.editForm.elements.name.value,u=P.editForm.elements.description.value,m("/users/me","PATCH",{name:a,about:u});case 2:o=e.v,j(o),n(P.editPopup),e.n=4;break;case 3:e.p=3,e.v,G("Ошибка обновления профиля");case 4:return e.p=4,q(r,!1),e.f(4);case 5:return e.a(2)}var a,u}),e,null,[[1,3,4,5]])})));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=E(w().m((function e(t){var r,o;return w().w((function(e){for(;;)switch(e.n){case 0:return t.preventDefault(),r=t.submitter,e.p=1,q(r,!0,"Создание..."),e.n=2,a=P.newCardForm.elements["place-name"].value,u=P.newCardForm.elements.link.value,m("/cards","POST",{name:a,link:u});case 2:o=e.v,P.placesList.prepend(A(o)),P.newCardForm.reset(),n(P.newCardPopup),e.n=4;break;case 3:e.p=3,e.v,G("Ошибка добавления карточки");case 4:return e.p=4,q(r,!1,"Создать"),e.f(4);case 5:return e.a(2)}var a,u}),e,null,[[1,3,4,5]])})));return function(t){return e.apply(this,arguments)}}(),J=function(){var e=E(w().m((function e(t){var r,o,a;return w().w((function(e){for(;;)switch(e.n){case 0:if(t.preventDefault(),r=t.submitter,o=P.editAvatarForm.elements.avatar.value,B(o)){e.n=1;break}return G("Введите корректный URL изображения"),e.a(2);case 1:return e.p=1,q(r,!0),e.n=2,y(o);case 2:a=e.v,P.profileImage.style.backgroundImage="url('".concat(a.avatar,"')"),P.editAvatarForm.reset(),n(P.editAvatarPopup),e.n=4;break;case 3:e.p=3,e.v,G("Ошибка обновления аватара");case 4:return e.p=4,q(r,!1),e.f(4);case 5:return e.a(2)}}),e,null,[[1,3,4,5]])})));return function(t){return e.apply(this,arguments)}}();document.addEventListener("DOMContentLoaded",(function(){var e;e=C,document.querySelectorAll(e.formSelector).forEach((function(t){!function(e,t){var r=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);r.forEach((function(a){"name"!==a.name&&"place-name"!==a.name||(a.pattern="^[a-zA-Zа-яА-ЯёЁ\\s-]+$",a.dataset.errorMessage="Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"),a.addEventListener("input",(function(){return o(e,a,r,n,t)})),a.addEventListener("blur",(function(){return o(e,a,r,n,t)}))})),l(r,n,t)}(t,e)})),P.editProfileButton.addEventListener("click",M),P.addCardButton.addEventListener("click",N),P.editAvatarButton.addEventListener("click",U),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",(function(){return n(e.closest(".popup"))}))})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target===e&&n(e)}))})),P.editForm.addEventListener("submit",D),P.newCardForm.addEventListener("submit",R),P.editAvatarForm.addEventListener("submit",J),O()}))})();